The CS50 Duck has been stolen! The town of Fiftyville has called upon you to solve the mystery of the stolen duck. Authorities believe that the thief stole the duck and then, shortly afterwards, took a flight out of town with the help of an accomplice. Your goal is to identify:

    Who the thief is,
    What city the thief escaped to, and
    Who the thief’s accomplice is who helped them escape

All you know is that the theft took place on July 28, 2021 and that it took place on Humphrey Street.

How will you go about solving this mystery? The Fiftyville authorities have taken some of the town’s records from around the time of the theft and prepared a SQLite database for you, fiftyville.db, which contains tables of data from around the town. You can query that table using SQL SELECT queries to access the data of interest to you. Using just the information in the database, your task is to solve the mystery.

--- Leer reporte de la escena del crimen
select * from crime_scene_reports WHERE day=28 and month=7 AND year = 2021 AND street='Humphrey Street';

/*Theft of the CS50 duck took place at 10:15 am at the Humphrey Street bakery. Interviews were conducted today with three witnesses who were present at the time – each of their interview transcripts mentions the bakery.*/
--- Leer en Interviews la descripcion de los testigos relacionados con bakery y la hora del robo que fue  a las 10:15 am

select * from interviews WHERE transcript LIKE "%bakery%" AND day=28 AND month=7;

/* Ruth: Sometime within ten minutes of the theft, I saw the thief get into a car in the bakery parking lot and drive away. If you have security footage from the bakery parking lot, you might want to look for cars that left the parking lot in that time frame.
Eugene: I don't know the thief's name, but it was someone I recognized. Earlier this morning, before I arrived at Emma's bakery, I was walking by the ATM on Leggett Street and saw the thief there withdrawing some money.
Raymond: As the thief was leaving the bakery, they called someone who talked to them for less than a minute. In the call, I heard the thief say that they were planning to take the earliest flight out of Fiftyville tomorrow. The thief then asked the person on the other end of the phone to purchase the flight ticket.*/

--- Encontrar el carro que dejo el parqueo entre las 10:15 y las 10:25 segun Ruth, y los datos del dueño del carro nombres  y sus telefonos :

SELECT name,phone_number FROM bakery_security_logs b 
JOIN people ON b.license_plate=people.license_plate
WHERE b.day=28 AND b.month=7 and b.hour= 10 and b.minute between 15 AND 25 
ORDER BY name;

Vanessa	(725) 555-4692
Bruce	(367) 555-5533
Barry	(301) 555-4174
Luca	(389) 555-5198
Sofia	(130) 555-0289
Iman	(829) 555-5269
Diana	(770) 555-1861
Kelsey	(499) 555-9472


-- De los dueños de carro hicieron llamadas:
Sofia	(130) 555-0289
Kelsey	(499) 555-9472
Bruce	(367) 555-5533
Diana	(770) 555-1861

SELECT DISTINCT name,phone_number FROM phone_calls ph
JOIN people p ON p.phone_number=ph.caller	
JOIN bakery_security_logs b ON b.license_plate=p.license_plate
WHERE ph.day=28 AND ph.month=7 AND ph.duration < 60 
AND b.day=28 AND b.month=7 and b.hour= 10 and b.minute BETWEEN 5 AND 25;


--- Encontrar quien hizo transaccion bancaria en la calle 'Leggett Street'  reportada ese dia y mes:

SELECT p.name,phone_number FROM bank_accounts bk
JOIN people p ON p.id=bk.person_id
JOIN atm_transactions at ON at.account_number=bk.account_number
WHERE at.atm_location='Leggett Street' 
AND  at.day=28 AND at.month=7 AND at.year=2021;

Bruce	(367) 555-5533
Kaelyn	(098) 555-1164
Diana	(770) 555-1861
Brooke	(122) 555-4581
Kenny	(826) 555-1652
Iman	(829) 555-5269
Luca	(389) 555-5198
Taylor	(286) 555-6063
Benista	(338) 555-6650



--- Hicieron llamadas de menos de un minuto y operaciones bancarias:

SELECT p.name,phone_number FROM bank_accounts bk
JOIN people p ON p.id=bk.person_id
JOIN atm_transactions at ON at.account_number=bk.account_number
JOIN bakery_security_logs b ON b.license_plate=p.license_plate
JOIN phone_calls ph ON p.phone_number=ph.caller
WHERE at.atm_location='Leggett Street' 
AND  at.day=28 AND at.month=7 AND at.year=2021
AND ph.day=28 AND ph.month=7 AND ph.duration < 60 
AND b.day=28 AND b.month=7 and b.hour= 10 and b.minute between 15 AND 25;


Bruce	(367) 555-5533
Diana	(770) 555-1861

__________________________________________
COMPLICE
__________________________________________

--- Encontrar quienes recibieron llamadas por menos de un minuto, usando los numeros de los dueños de los carros (Para comprar pasaje de avion)

SELECT people.name FROM people WHERE people.phone_number IN
	(SELECT receiver FROM phone_calls WHERE duration <= 60 AND 
		caller IN
	(SELECT phone_number FROM bakery_security_logs b JOIN people
		ON b.license_plate=people.license_plate
		WHERE b.day=28 AND b.month=7 and b.hour= 10 and b.minute between 15 AND 25));

Larry
Jack
Melissa
Charlotte
Philip
Robin

_________________________________________________

SELECT name FROM people p
JOIN phone_calls ph
ON p.phone_number=ph.receiver
WHERE ph.day=28 AND ph.month=7 AND ph.duration < 60
AND ph.caller=
	(SELECT phone_number FROM people WHERE name='Bruce');

Rpta: Robin






--- Buscar destino del primer vuelo del dia 29 

LaGuardia Airport	New York City

SELECT full_name,city FROM flights 
JOIN airports ON airports.id=flights.destination_airport_id
WHERE day=29 AND month=7 AND year=2021 
ORDER BY hour
LIMIT 1;

--- Lista de pasajeros de ese vuelo

395717	Kenny	(826) 555-1652
398010	Sofia	(130) 555-0289
449774	Taylor	(286) 555-6063
467400	Luca	(389) 555-5198
560886	Kelsey	(499) 555-9472
651714	Edward	(328) 555-1152
686048	Bruce	(367) 555-5533
953679	Doris	(066) 555-9701



_________

ENCONTRAR EL LADRON : BRUCE

SELECT DISTINCT name FROM people p
JOIN passengers pa
ON p.passport_number = pa.passport_number
JOIN bakery_security_logs as b
ON b.license_plate = p.license_plate
JOIN bank_accounts bk
ON p.id=bk.person_id
JOIN atm_transactions at
ON bk.account_number=at.account_number
JOIN phone_calls ph
ON p.phone_number=ph.caller	
WHERE atm_location='Leggett Street'
AND ph.day=28 AND ph.month=7 AND ph.duration < 60 
AND b.day=28 AND b.month=7 and b.hour= 10 and b.minute BETWEEN 5 AND 25
AND pa.flight_id=(SELECT flights.id FROM flights 
	JOIN airports ON airports.id=flights.destination_airport_id
	WHERE day=29 AND month=7 AND year=2021 ORDER BY hour
	LIMIT 1);




___________________________________________


